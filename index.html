<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Jessi & Chris - 20.06.2026</title>
<style>
  body {
    background: white;
    font-family: 'Georgia', serif;
    color: #2a4d2a; /* dunkles gr√ºn */
    margin: 0; padding: 20px;
    display: flex; flex-direction: column; align-items: center;
  }
  h1 {
    color: #2a4d2a; /* dunkles gr√ºn */
    font-size: 2.5rem;
    margin-bottom: 0;
  }
  #cameraContainer {
    position: relative;
    width: 90vw;
    max-width: 500px;
    aspect-ratio: 4 / 3;
    border: 4px solid #2a4d2a; /* dunkles gr√ºn */
    border-radius: 10px;
    overflow: hidden;
    margin-top: 20px;
    background: black;
  }
  video, img#photo {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 10px;
    filter: sepia(0.2); /* leichter Sepia-Filter */
  }
  /* Frontkamera gespiegelt */
  video.frontcam {
    transform: scaleX(-1);
  }
  img#photo {
    display: none;
  }
  canvas {
    display: none;
  }
  #buttons {
    margin-top: 20px;
    width: 90vw;
    max-width: 500px;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 12px;
  }
  button, label {
    background-color: #2a4d2a;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 12px 18px;
    font-size: 1rem;
    cursor: pointer;
    font-weight: bold;
    box-shadow: 0 2px 5px rgba(42, 77, 42, 0.6);
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
    user-select: none;
    display: inline-flex;
    align-items: center;
  }
  button:hover, label:hover {
    background-color: #8c6700;
  }
  button:active, label:active {
    box-shadow: 0 0 12px 3px #a17c00; /* goldener Glow beim Klicken */
  }
  /* Datei-Input verstecken, Label als Button */
  input[type="file"] {
    display: none;
  }
  #message {
    margin-top: 15px;
    font-weight: bold;
    color: #a17c00;
    min-height: 1.5em;
    text-align: center;
  }
  @media (max-width: 400px) {
    #buttons {
      gap: 8px;
    }
    button, label {
      padding: 10px 14px;
      font-size: 0.9rem;
    }
  }
</style>
</head>
<body>
  <h1>Jessi & Chris - 20.06.2026</h1>

  <div id="cameraContainer">
    <video id="video" autoplay playsinline></video>
    <img id="photo" alt="Aufgenommenes Foto" />
    <canvas id="canvas"></canvas>
  </div>

  <div id="buttons">
    <button id="frontBtn" type="button">Frontkamera</button>
    <button id="backBtn" type="button">R√ºckkamera</button>
    <button id="takePhotoBtn" type="button">üì∏ Foto machen</button>
    <button id="uploadBtn" type="button" disabled>‚¨ÜÔ∏è Hochladen</button>
    <label for="galleryInput" title="Bild aus Galerie ausw√§hlen">üñºÔ∏è Galerie</label>
    <input type="file" id="galleryInput" accept="image/*" capture="environment">
    <button id="saveBtn" type="button" disabled>üíæ Speichern</button>
  </div>

  <div id="message"></div>

<script>
  const video = document.getElementById('video');
  const canvas = document.getElementById('canvas');
  const photo = document.getElementById('photo');
  const message = document.getElementById('message');
  const galleryInput = document.getElementById('galleryInput');
  const uploadBtn = document.getElementById('uploadBtn');
  const saveBtn = document.getElementById('saveBtn');

  let currentStream = null;
  let currentFacingMode = 'user'; // 'user' = front, 'environment' = back
  let capturedImageBlob = null;

  // Starte Kamera mit gew√§hlter Kamera
  async function startCamera(facingMode) {
    if (currentStream) {
      currentStream.getTracks().forEach(track => track.stop());
    }
    try {
      currentStream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: { exact: facingMode } },
        audio: false
      });
      video.srcObject = currentStream;
      currentFacingMode = facingMode;
      message.textContent = '';
      uploadBtn.disabled = true;
      saveBtn.disabled = true;
      photo.src = '';
      photo.style.display = 'none';
      video.style.display = 'block';
      updateVideoMirror();
      capturedImageBlob = null;
    } catch (err) {
      // Fallback ohne exact
      try {
        currentStream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: facingMode },
          audio: false
        });
        video.srcObject = currentStream;
        currentFacingMode = facingMode;
        message.textContent = '';
        uploadBtn.disabled = true;
        saveBtn.disabled = true;
        photo.src = '';
        photo.style.display = 'none';
        video.style.display = 'block';
        updateVideoMirror();
        capturedImageBlob = null;
      } catch (error) {
        console.error('Kamera konnte nicht gestartet werden:', error);
        message.textContent = 'Kamera konnte nicht gestartet werden. Bitte √ºberpr√ºfe die Berechtigungen.';
      }
    }
  }

  // Spiegelung der Frontkamera
  function updateVideoMirror() {
    if (currentFacingMode === 'user') {
      video.classList.add('frontcam');
    } else {
      video.classList.remove('frontcam');
    }
  }

  document.getElementById('frontBtn').addEventListener('click', () => startCamera('user'));
  document.getElementById('backBtn').addEventListener('click', () => startCamera('environment'));

  document.getElementById('takePhotoBtn').addEventListener('click', () => {
    if (!currentStream) {
      message.textContent = 'Bitte erst Kamera ausw√§hlen.';
      return;
    }
    const width = video.videoWidth;
    const height = video.videoHeight;
    canvas.width = width;
    canvas.height = height;
    const ctx = canvas.getContext('2d');

    // Wenn Frontkamera, Bild spiegeln, damit Foto nicht spiegelverkehrt ist
    if(currentFacingMode === 'user') {
      ctx.translate(width, 0);
      ctx.scale(-1, 1);
    }

    ctx.drawImage(video, 0, 0, width, height);

    if(currentFacingMode === 'user') {
      ctx.setTransform(1,0,0,1,0,0); // Reset Transform
    }

    canvas.toBlob(blob => {
      capturedImageBlob = blob;
      photo.src = URL.createObjectURL(blob);
      photo.style.display = 'block';
      video.style.display = 'none';

      uploadBtn.disabled = false;
      saveBtn.disabled = false;
      message.textContent = 'Foto aufgenommen. Jetzt Hochladen oder Speichern.';
    }, 'image/jpeg', 0.95);
  });

  // Bild aus Galerie ausw√§hlen
  galleryInput.addEventListener('change', () => {
    const file = galleryInput.files[0];
    if (!file) return;
    capturedImageBlob = file;
    photo.src = URL.createObjectURL(file);
    photo.style.display = 'block';
    video.style.display = 'none';
    uploadBtn.disabled = false;
    saveBtn.disabled = false;
    message.textContent = 'Bild aus Galerie gew√§hlt. Jetzt Hochladen oder Speichern.';
  });

  // Upload in Dropbox
  uploadBtn.addEventListener('click', async () => {
    if (!capturedImageBlob) {
      message.textContent = 'Bitte erst ein Foto machen oder ausw√§hlen.';
      return;
    }
    message.textContent = 'Lade Bild hoch...';

    // Hier deinen Dropbox Access Token einf√ºgen
    const DROPBOX_ACCESS_TOKEN = 'sl.u.AF1AVvWSZesjV8N-pZTAvwUM-puo2R8g9B9RC9ItUPLcsZIt3VvpbWwFJ-q8z53OllgXTvNjMMGrvMokyoVnUbO27GWZRK6TGinWTiuxk595QK0uThDG3i5EFN9-6hluDvjCw1l3iCc9ZFIM5yTQA8dU_tgRilKGydd1Y_MTu49xQ8JXlKmtM0nsYdPh1NiOFzk279ytGFFT9gxjk7NGMbtyUZ9cQYZhuKtbWrcvMH1qbxG2GW9jaLVcCVcPZl9s59E3esUrN-Ne_uiHHBvbtSjsCxoAPjeGZxoZMUbw5LfQDbJVFR5iFlwzwFqW7kJhrhq3atuq-MfuGEhsiIsbzrEJfoI_rvn26I7ZAgSQBxxOLqTKzN1v2vgSby3F5XVR1HtbigViBLNoSv78BdW_Jn71Oi29mo2SxT-0hHtFxb_NB7-vEtMYtCQuC7nc9ZvTc8ztcjzPDryvYvWzxrjRwYT2uYLksUnYVpM9_q9WLHiCDOPPhmWKYjvv0mCdkWgftdw7nPMrkL4PWN0BI734V3F157hDi2jipnXVkinfOENZ16CqrKXkbF7fT0H119I8_5_mj_Px-Y_wgYQFWHSqiE80ybLI6QjXMWzwVZ9tdHEUIsmxZHJd2E1Sl9Ml-TTKy4wI7PKsZm4kkJspHwfw7-J9z3YwFLFFelU2rlA32gMzKffPHhuMqvsqywVTYVzTR7MGsKLq3byiXjFIwhI2IcYHXiX7glau7rWjkdnAGeGOls8BH4O54x7_Ujm7ItBe4QW43RouiKbf1hFcN4Nq8KziAOFiekyUmNSm-20fcLVg5HoR81pYO8Cw66MpAOPohXZQR75pohEqjtVXjEzwqTpBWzRl35pZpE0ivAHsQzuzo0330YHUEB1WVgPtxZYp-AbJRpTmiTUPSknWVSlYIoCUTsh5xrBLMn7N-nWybUp-y5pJ8dxcOv6ZkzjBBBAunmc5jz32qi1VZqxy0NRzRN5Pvz4JS-FxwJXkTmYQNP3dRqIJUnXp4lp2QCOf5JwYiFEEkGmkIKF4pXrmWjhXTIu7X_tB7YhWlBYIF6VxDmYu__-pBERMJW3FU8YERG02pkY9CzD_YEOqurp65VB4pT8MNSXnUxCyNEx3xqTyTWn3hIHDCj3DQKfJ-13iZHwilyCopFr9xvxg8D-hn5V9pJqdtXPm2jTWvuXSHSAg5ihY8HvAK4jJtIEQh0xOGLV0436thTg4o87fIQJYDriWV-mp_p2rOAS9llwgLs9mUVtZ5Lk5qrkQrZatyvAyaPpD6klKSkBzKVFmrFoCEQ0HSKfwXcZhPewkh8lCVw-DVZSQFg';

    const filename = `JessiChris_${Date.now()}.jpg`;

    try {
      const response = await fetch('https://content.dropboxapi.com/2/files/upload', {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${DROPBOX_ACCESS_TOKEN}`,
          'Dropbox-API-Arg': JSON.stringify({
            path: '/' + filename,
            mode: 'add',
            autorename: true,
            mute: false,
          }),
          'Content-Type': 'application/octet-stream',
        },
        body: capturedImageBlob
      });

      if (!response.ok) {
        const error = await response.json();
        throw new Error(error.error_summary || 'Unbekannter Fehler');
      }

      message.textContent = 'Bild erfolgreich hochgeladen. Danke! üéâ';

      // Nach Upload Bild zur√ºcksetzen & Kamera wieder starten
      photo.style.display = 'none';
      video.style.display = 'block';
      uploadBtn.disabled = true;
      saveBtn.disabled = true;
      capturedImageBlob = null;
      startCamera(currentFacingMode);

    } catch (error) {
      console.error('Upload-Fehler:', error);
      message.textContent = 'Fehler beim Hochladen: ' + error.message;
    }
  });

  // Foto auf Ger√§t speichern (Download)
  saveBtn.addEventListener('click', () => {
    if (!capturedImageBlob) {
      message.textContent = 'Kein Bild zum Speichern.';
      return;
    }
    const url = URL.createObjectURL(capturedImageBlob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `JessiChris_${Date.now()}.jpg`;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
    message.textContent = 'Bild wurde in deiner Galerie gespeichert.';
  });

  // Starte default mit Frontkamera
  startCamera('user');
</script>
</body>
</html>

